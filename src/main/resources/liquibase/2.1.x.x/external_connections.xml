<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

	<changeSet author="csteele" id="1">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="external_connection" />
			</not>
		</preConditions>
		<createTable schemaName="clinlims"
			tableName="external_connection">
			<column name="id" type="INTEGER" valueSequenceNext="external_connection_seq" >
				<constraints primaryKey="true" />
			</column>
			<column name="active" type="BOOLEAN" />
			<column name="uri" type="VARCHAR(255)" />
			<column name="name" type="VARCHAR(255)" />
			<column name="name_localization_id" type="NUMERIC(10)" >
				<constraints
					foreignKeyName="fk_external_connection_name_localization"
					references="localization(id)"/>
			</column>
			<column name="description_localization_id" type="NUMERIC(10)" >
				<constraints
					foreignKeyName="fk_external_connection_description_localization"
					references="localization(id)"/>
			</column>
			<column name="active_authentication_type" type="VARCHAR(255)" />
			<column name="last_updated" type="DATE" />
		</createTable>
		<createSequence incrementBy="1" schemaName="clinlims"
			sequenceName="external_connection_seq" startValue="1" />
	</changeSet>
	
	<changeSet author="csteele" id="2">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="external_connection_contact" />
			</not>
		</preConditions>
		<createTable schemaName="clinlims"
			tableName="external_connection_contact">
			<column name="id" type="INTEGER" valueSequenceNext="external_connection_contact_seq" >
				<constraints primaryKey="true" />
			</column>
			<column name="external_connection_id" type="INTEGER" >
				<constraints
					foreignKeyName="fk_external_connection_contact_external_connection"
					references="external_connection(id)"/>
			</column>
			<column name="person_id" type="NUMERIC(10)" >
				<constraints
					foreignKeyName="fk_external_connection_contact_person"
					references="person(id)"/>
			</column>
			<column name="last_updated" type="DATE" />
		</createTable>
		<createSequence incrementBy="1" schemaName="clinlims"
			sequenceName="external_connection_contact_seq" startValue="1" />
	</changeSet>
	
	<changeSet author="csteele" id="3">
		<preConditions onFail="MARK_RAN">
			<not>
				<tableExists tableName="certificate_authentication_data" />
			</not>
		</preConditions>
		<createTable schemaName="clinlims"
			tableName="certificate_authentication_data">
			<column name="id" type="INTEGER" valueSequenceNext="certificate_authentication_data_seq" >
				<constraints primaryKey="true" />
			</column>
			<column name="external_connection_id" type="INTEGER" >
				<constraints
					foreignKeyName="fk_certificate_authentication_data_external_connection"
					references="external_connection(id)"/>
			</column>
			<column name="last_updated" type="DATE" />
		</createTable>
		<createSequence incrementBy="1" schemaName="clinlims"
			sequenceName="certificate_authentication_data_seq" startValue="1" />
	</changeSet>

</databaseChangeLog>