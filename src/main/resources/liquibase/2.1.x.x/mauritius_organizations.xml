<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
	  
	  
  	<property name="now" value="now()" dbms="postgresql"/>

	<changeSet author="csteele" id="1" context="mauritius">
		<preConditions onFail="MARK_RAN">
			<sqlCheck  expectedResult="0">SELECT count(*) FROM clinlims.organization WHERE name = 'Flacq'</sqlCheck> 
		</preConditions>
		
		<!-- plain sql usage is discouraged as it may be less transferrable than liquibase xml commands
			but it is used here as executing this in liquibase is difficult -->
		<sql dbms="postgresql">
			UPDATE clinlims.organization as o
			SET is_active  = 'N'
			FROM clinlims.organization_organization_type AS oot
			INNER JOIN clinlims.organization_type AS ot
				ON oot.org_type_id = ot.id
			WHERE ot.short_name = 'Health Region' AND oot.org_type_id = ot.id  AND oot.org_id = o.id;
		</sql>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Flacq" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Flacq')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Grand Port" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Grand Port')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Moka" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Moka')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Pamplemousses" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Pamplemousses')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Plaines Wilhems" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Plaines Wilhems')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Port Louis" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Port Louis')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Rivière du Rempart" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Rivière du Rempart')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Rivière Noire" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Rivière Noire')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		
		<insert schemaName="clinlims" tableName="organization">
			<column name="id" valueSequenceNext="organization_seq" />
			<column name="name" value="Savanne" />
			<column name="mls_sentinel_lab_flag" value="N" />
			<column name="short_name" value="" />
			<column name="internet_address" value="" />
			<column name="lastupdated" valueComputed="${now}" />
			<column name="mls_lab_flag" value="N" />
			<column name="is_active" value="Y" />
		</insert>
		<insert schemaName="clinlims" tableName="organization_organization_type">
			<column name="org_id" valueComputed="(SELECT id FROM organization WHERE name = 'Savanne')" />
			<column name="org_type_id" valueComputed="(SELECT id FROM organization_type WHERE short_name = 'Health Region')" />
		</insert>
		<rollback>
			<delete schemaName="clinlims" tableName="organization_organization_type">
				<where>
					org_id = (SELECT id FROM organization WHERE name = 'Flacq') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Grand Port') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Moka') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Pamplemousses') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Plaines Wilhems') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Port Louis') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Rivière du Rempart') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Rivière Noire') 
					OR org_id = (SELECT id FROM organization WHERE name = 'Savanne') 
				</where>
			</delete>
			<delete schemaName="clinlims" tableName="organization">
				<where>
					name = 'Flacq' 
					OR name = 'Grand Port' 
					OR name = 'Moka' 
					OR name = 'Pamplemousses' 
					OR name = 'Plaines Wilhems' 
					OR name = 'Port Louis' 
					OR name = 'Rivière du Rempart' 
					OR name = 'Rivière Noire' 
					OR name = 'Savanne' 
				</where>
			</delete>
		</rollback>
	</changeSet>
</databaseChangeLog>